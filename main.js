(()=>{"use strict";function e(e,t){const l=e<t,s=e>=t*(t-1),i=e%t==0,n=(e+1)%t==0;return l&&i?"top-left":l&&n?"top-right":s&&i?"bottom-left":s&&n?"bottom-right":l?"top":s?"bottom":i?"left":n?"right":"center"}let t=null;function l(e){const l=function(e){const t=e**2;return Array.from({length:t/8},((e,t)=>8*t)).flatMap((e=>[e,e+1]))}(e);let s;do{s=Math.floor(Math.random()*l.length)}while(l[s]===t);return t=l[s],t}const s={auto:"auto",pointer:"pointer",crosshair:"crosshair",notallowed:"not-allowed"};const i=new class{constructor(e){this.boardSize=e,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const l=document.createElement("div");l.classList.add("cell","map-tile",`map-tile-${e(t,this.boardSize)}`),l.addEventListener("mouseenter",(e=>this.onCellEnter(e))),l.addEventListener("mouseleave",(e=>this.onCellLeave(e))),l.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(l)}this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";const t=this.boardEl.children[e],l=document.createElement("div");l.classList.add("character","generic"),t.appendChild(l)}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((e=>e.call(null,t)))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((e=>e.call(null,t)))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}selectCell(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red";this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`)}deselectCell(e){const t=this.cells[e];t.classList.remove(...Array.from(t.classList).filter((e=>e.startsWith("selected"))))}hideCellTooltip(e){this.cells[e].title=""}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}(4);i.bindToDOM(document.querySelector("#game-container"));const n=new class{constructor(e){this.gamePlay=e,this.indexSelect={},this.onCellClick=this.onCellClick.bind(this),this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this)}init(){this.events(),this.gamePlay.drawUi("prairie"),this.showCharacter()}events(){this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick)}onCellClick(e){this.gamePlay.setCursor(s.crosshair),document.querySelector(".selected-red")&&this.gamePlay.deselectCell(this.indexSelect.red),this.gamePlay.selectCell(e),this.indexSelect.red=e}onCellEnter(){this.gamePlay.setCursor(s.pointer)}onCellLeave(e){this.gamePlay.hideCellTooltip(e)}showCharacter(){const e=setInterval((()=>{const e=l(this.gamePlay.boardSize);this.gamePlay.redrawPositions(e)}),1e3);setTimeout((()=>clearInterval(e)),1e6)}}(i);n.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQWUsU0FBU0EsRUFBYUMsRUFBT0MsR0FDMUMsTUFBTUMsRUFBV0YsRUFBUUMsRUFDbkJFLEVBQWNILEdBQVNDLEdBQWFBLEVBQVksR0FDaERHLEVBQWVKLEVBQVFDLEdBQWMsRUFDckNJLEdBQWlCTCxFQUFRLEdBQUtDLEdBQWMsRUFFbEQsT0FBSUMsR0FBWUUsRUFBcUIsV0FDakNGLEdBQVlHLEVBQXNCLFlBQ2xDRixHQUFlQyxFQUFxQixjQUNwQ0QsR0FBZUUsRUFBc0IsZUFDckNILEVBQWlCLE1BQ2pCQyxFQUFvQixTQUNwQkMsRUFBcUIsT0FDckJDLEVBQXNCLFFBQ25CLFFBQ1QsQ0NmQSxJQUFJQyxFQUFlLEtBU0osU0FBU0MsRUFBZU4sR0FDckMsTUFBTU8sRUFSUixTQUE4QlAsR0FDNUIsTUFBTVEsRUFBYVIsR0FBYSxFQUNoQyxPQUFPUyxNQUFNQyxLQUFLLENBQUVDLE9BQVFILEVBQWEsSUFBSyxDQUFDSSxFQUFHQyxJQUFVLEVBQUpBLElBQU9DLFNBQzVEQyxHQUFTLENBQUNBLEVBQU1BLEVBQU8sSUFFNUIsQ0FHZ0JDLENBQXFCaEIsR0FDbkMsSUFBSWlCLEVBRUosR0FDRUEsRUFBT0MsS0FBS0MsTUFBTUQsS0FBS0UsU0FBV2IsRUFBTUksY0FDakNKLEVBQU1VLEtBQVVaLEdBR3pCLE9BREFBLEVBQWVFLEVBQU1VLEdBQ2RaLENBQ1QsQ0NuQkEsTUFPQSxFQVBnQixDQUNkZ0IsS0FBTSxPQUNOQyxRQUFTLFVBQ1RDLFVBQVcsWUFDWEMsV0FBWSxlQ0RkLE1BQU1DLEVBQVcsSUNERixNQUNiQyxXQUFBQSxDQUFZMUIsR0FDVjJCLEtBQUszQixVQUFZQSxFQUNqQjJCLEtBQUtDLFVBQVksS0FDakJELEtBQUtFLFFBQVUsS0FDZkYsS0FBS3BCLE1BQVEsR0FDYm9CLEtBQUtHLG1CQUFxQixHQUMxQkgsS0FBS0ksbUJBQXFCLEdBQzFCSixLQUFLSyxtQkFBcUIsRUFDNUIsQ0FFQUMsU0FBQUEsQ0FBVUwsR0FDUixLQUFNQSxhQUFxQk0sYUFDekIsTUFBTSxJQUFJQyxNQUFNLGdDQUVsQlIsS0FBS0MsVUFBWUEsQ0FDbkIsQ0FFQVEsTUFBQUEsQ0FBT0MsR0FDTFYsS0FBS1csZUFFTFgsS0FBS0MsVUFBVVcsVUFBYSwrR0FNNUJaLEtBQUtFLFFBQVVGLEtBQUtDLFVBQVVZLGNBQWMsbUJBRTVDYixLQUFLRSxRQUFRWSxVQUFVQyxJQUFJTCxHQUMzQixJQUFLLElBQUl4QixFQUFJLEVBQUdBLEVBQUljLEtBQUszQixXQUFhLEVBQUdhLEdBQUssRUFBRyxDQUMvQyxNQUFNOEIsRUFBU0MsU0FBU0MsY0FBYyxPQUN0Q0YsRUFBT0YsVUFBVUMsSUFBSSxPQUFRLFdBQWEsWUFBVzVDLEVBQWFlLEVBQUdjLEtBQUszQixjQUMxRTJDLEVBQU9HLGlCQUFpQixjQUFlQyxHQUFVcEIsS0FBS3FCLFlBQVlELEtBQ2xFSixFQUFPRyxpQkFBaUIsY0FBZUMsR0FBVXBCLEtBQUtzQixZQUFZRixLQUNsRUosRUFBT0csaUJBQWlCLFNBQVVDLEdBQVVwQixLQUFLdUIsWUFBWUgsS0FDN0RwQixLQUFLRSxRQUFRc0IsWUFBWVIsRUFDM0IsQ0FFQWhCLEtBQUtwQixNQUFRRSxNQUFNQyxLQUFLaUIsS0FBS0UsUUFBUXVCLFNBQ3ZDLENBRUFDLGVBQUFBLENBQWdCQyxHQUNkLElBQUssTUFBTXZDLEtBQVFZLEtBQUtwQixNQUN0QlEsRUFBS3dCLFVBQVksR0FHbkIsTUFBTUksRUFBU2hCLEtBQUtFLFFBQVF1QixTQUFTRSxHQUMvQkMsRUFBU1gsU0FBU0MsY0FBYyxPQUN0Q1UsRUFBT2QsVUFBVUMsSUFBSSxZQUFhLFdBRWxDQyxFQUFPUSxZQUFZSSxFQUNyQixDQUVBQyxvQkFBQUEsQ0FBcUJDLEdBQ25COUIsS0FBS0ksbUJBQW1CMkIsS0FBS0QsRUFDL0IsQ0FFQUUsb0JBQUFBLENBQXFCRixHQUNuQjlCLEtBQUtLLG1CQUFtQjBCLEtBQUtELEVBQy9CLENBRUFHLG9CQUFBQSxDQUFxQkgsR0FDbkI5QixLQUFLRyxtQkFBbUI0QixLQUFLRCxFQUMvQixDQUVBVCxXQUFBQSxDQUFZRCxHQUNWQSxFQUFNYyxpQkFDTixNQUFNOUQsRUFBUTRCLEtBQUtwQixNQUFNdUQsUUFBUWYsRUFBTWdCLGVBQ3ZDcEMsS0FBS0ksbUJBQW1CaUMsU0FBU0MsR0FBTUEsRUFBRUMsS0FBSyxLQUFNbkUsSUFDdEQsQ0FFQWtELFdBQUFBLENBQVlGLEdBQ1ZBLEVBQU1jLGlCQUNOLE1BQU05RCxFQUFRNEIsS0FBS3BCLE1BQU11RCxRQUFRZixFQUFNZ0IsZUFDdkNwQyxLQUFLSyxtQkFBbUJnQyxTQUFTQyxHQUFNQSxFQUFFQyxLQUFLLEtBQU1uRSxJQUN0RCxDQUVBbUQsV0FBQUEsQ0FBWUgsR0FDVixNQUFNaEQsRUFBUTRCLEtBQUtwQixNQUFNdUQsUUFBUWYsRUFBTWdCLGVBQ3ZDcEMsS0FBS0csbUJBQW1Ca0MsU0FBU0MsR0FBTUEsRUFBRUMsS0FBSyxLQUFNbkUsSUFDdEQsQ0FFQW9FLFVBQUFBLENBQVdwRSxHQUFzQixJQUFmcUUsRUFBS0MsVUFBQTFELE9BQUEsUUFBQTJELElBQUFELFVBQUEsR0FBQUEsVUFBQSxHQUFHLE1BQ3hCMUMsS0FBSzRDLGFBQWF4RSxHQUNsQjRCLEtBQUtwQixNQUFNUixHQUFPMEMsVUFBVUMsSUFBSSxXQUFhLFlBQVcwQixJQUMxRCxDQUVBRyxZQUFBQSxDQUFheEUsR0FDWCxNQUFNZ0IsRUFBT1ksS0FBS3BCLE1BQU1SLEdBQ3hCZ0IsRUFBSzBCLFVBQVUrQixVQUFVL0QsTUFBTUMsS0FBS0ssRUFBSzBCLFdBQ3RDZ0MsUUFBUVIsR0FBTUEsRUFBRVMsV0FBVyxjQUNoQyxDQUVBQyxlQUFBQSxDQUFnQjVFLEdBQ2Q0QixLQUFLcEIsTUFBTVIsR0FBTzZFLE1BQVEsRUFDNUIsQ0FFQUMsU0FBQUEsQ0FBVUMsR0FDUm5ELEtBQUtFLFFBQVFrRCxNQUFNRCxPQUFTQSxDQUM5QixDQUVBeEMsWUFBQUEsR0FDRSxHQUF1QixPQUFuQlgsS0FBS0MsVUFDUCxNQUFNLElBQUlPLE1BQU0sMkJBRXBCLEdEekc0QixHQUM5QlYsRUFBU1EsVUFBVVcsU0FBU0osY0FBYyxvQkFFMUMsTUFBTXdDLEVBQVcsSUVIRixNQUNidEQsV0FBQUEsQ0FBWUQsR0FDVkUsS0FBS0YsU0FBV0EsRUFDaEJFLEtBQUtzRCxZQUFjLENBQUMsRUFDcEJ0RCxLQUFLdUIsWUFBY3ZCLEtBQUt1QixZQUFZZ0MsS0FBS3ZELE1BQ3pDQSxLQUFLcUIsWUFBY3JCLEtBQUtxQixZQUFZa0MsS0FBS3ZELE1BQ3pDQSxLQUFLc0IsWUFBY3RCLEtBQUtzQixZQUFZaUMsS0FBS3ZELEtBQzNDLENBRUF3RCxJQUFBQSxHQUNFeEQsS0FBS3lELFNBQ0x6RCxLQUFLRixTQUFTVyxPQUFPLFdBQ3JCVCxLQUFLMEQsZUFDUCxDQUVBRCxNQUFBQSxHQUNFekQsS0FBS0YsU0FBUytCLHFCQUFxQjdCLEtBQUtxQixhQUN4Q3JCLEtBQUtGLFNBQVNrQyxxQkFBcUJoQyxLQUFLc0IsYUFDeEN0QixLQUFLRixTQUFTbUMscUJBQXFCakMsS0FBS3VCLFlBQzFDLENBRUFBLFdBQUFBLENBQVluRCxHQUNWNEIsS0FBS0YsU0FBU29ELFVBQVVTLEVBQVEvRCxXQUM1QnFCLFNBQVNKLGNBQWMsa0JBQ3pCYixLQUFLRixTQUFTOEMsYUFBYTVDLEtBQUtzRCxZQUFZTSxLQUc5QzVELEtBQUtGLFNBQVMwQyxXQUFXcEUsR0FDekI0QixLQUFLc0QsWUFBWU0sSUFBTXhGLENBQ3pCLENBRUFpRCxXQUFBQSxHQUNFckIsS0FBS0YsU0FBU29ELFVBQVVTLEVBQVFoRSxRQUNsQyxDQUVBMkIsV0FBQUEsQ0FBWWxELEdBQ1Y0QixLQUFLRixTQUFTa0QsZ0JBQWdCNUUsRUFDaEMsQ0FFQXNGLGFBQUFBLEdBQ0UsTUFBTUcsRUFBVUMsYUFBWSxLQUMxQixNQUFNbkMsRUFBV2hELEVBQWVxQixLQUFLRixTQUFTekIsV0FDOUMyQixLQUFLRixTQUFTNEIsZ0JBQWdCQyxFQUFTLEdBQ3RDLEtBRUhvQyxZQUFXLElBQU1DLGNBQWNILElBQVUsSUFDM0MsR0YzQ2tDL0QsR0FDcEN1RCxFQUFTRyxNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW92aW5nLWVsZW1lbnQvLi9zcmMvanMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vbW92aW5nLWVsZW1lbnQvLi9zcmMvanMvY3JlYXRlUG9zaXRpb24uanMiLCJ3ZWJwYWNrOi8vbW92aW5nLWVsZW1lbnQvLi9zcmMvanMvY3Vyc29ycy5qcyIsIndlYnBhY2s6Ly9tb3ZpbmctZWxlbWVudC8uL3NyYy9qcy9hcHAuanMiLCJ3ZWJwYWNrOi8vbW92aW5nLWVsZW1lbnQvLi9zcmMvanMvR2FtZVBsYXkuanMiLCJ3ZWJwYWNrOi8vbW92aW5nLWVsZW1lbnQvLi9zcmMvanMvR2FtZUNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY2FsY1RpbGVUeXBlKGluZGV4LCBib2FyZFNpemUpIHtcbiAgY29uc3QgaXNUb3BSb3cgPSBpbmRleCA8IGJvYXJkU2l6ZTtcbiAgY29uc3QgaXNCb3R0b21Sb3cgPSBpbmRleCA+PSBib2FyZFNpemUgKiAoYm9hcmRTaXplIC0gMSk7XG4gIGNvbnN0IGlzTGVmdENvbHVtbiA9IGluZGV4ICUgYm9hcmRTaXplID09PSAwO1xuICBjb25zdCBpc1JpZ2h0Q29sdW1uID0gKGluZGV4ICsgMSkgJSBib2FyZFNpemUgPT09IDA7XG5cbiAgaWYgKGlzVG9wUm93ICYmIGlzTGVmdENvbHVtbikgcmV0dXJuICd0b3AtbGVmdCc7XG4gIGlmIChpc1RvcFJvdyAmJiBpc1JpZ2h0Q29sdW1uKSByZXR1cm4gJ3RvcC1yaWdodCc7XG4gIGlmIChpc0JvdHRvbVJvdyAmJiBpc0xlZnRDb2x1bW4pIHJldHVybiAnYm90dG9tLWxlZnQnO1xuICBpZiAoaXNCb3R0b21Sb3cgJiYgaXNSaWdodENvbHVtbikgcmV0dXJuICdib3R0b20tcmlnaHQnO1xuICBpZiAoaXNUb3BSb3cpIHJldHVybiAndG9wJztcbiAgaWYgKGlzQm90dG9tUm93KSByZXR1cm4gJ2JvdHRvbSc7XG4gIGlmIChpc0xlZnRDb2x1bW4pIHJldHVybiAnbGVmdCc7XG4gIGlmIChpc1JpZ2h0Q29sdW1uKSByZXR1cm4gJ3JpZ2h0JztcbiAgcmV0dXJuICdjZW50ZXInO1xufVxuIiwibGV0IGxhc3RQb3NpdGlvbiA9IG51bGw7XG5cbmZ1bmN0aW9uIGNyZWF0ZUFycmF5UG9zaXRpb25zKGJvYXJkU2l6ZSkge1xuICBjb25zdCB0b3RhbENlbGxzID0gYm9hcmRTaXplICoqIDI7XG4gIHJldHVybiBBcnJheS5mcm9tKHsgbGVuZ3RoOiB0b3RhbENlbGxzIC8gOCB9LCAoXywgaSkgPT4gaSAqIDgpLmZsYXRNYXAoXG4gICAgKGNlbGwpID0+IFtjZWxsLCBjZWxsICsgMV0sXG4gICk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uKGJvYXJkU2l6ZSkge1xuICBjb25zdCBjZWxscyA9IGNyZWF0ZUFycmF5UG9zaXRpb25zKGJvYXJkU2l6ZSk7XG4gIGxldCByYW5kO1xuXG4gIGRvIHtcbiAgICByYW5kID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2VsbHMubGVuZ3RoKTtcbiAgfSB3aGlsZSAoY2VsbHNbcmFuZF0gPT09IGxhc3RQb3NpdGlvbik7XG5cbiAgbGFzdFBvc2l0aW9uID0gY2VsbHNbcmFuZF07XG4gIHJldHVybiBsYXN0UG9zaXRpb247XG59XG4iLCJjb25zdCBjdXJzb3JzID0ge1xuICBhdXRvOiAnYXV0bycsXG4gIHBvaW50ZXI6ICdwb2ludGVyJyxcbiAgY3Jvc3NoYWlyOiAnY3Jvc3NoYWlyJyxcbiAgbm90YWxsb3dlZDogJ25vdC1hbGxvd2VkJyxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGN1cnNvcnM7XG4iLCJpbXBvcnQgR2FtZVBsYXkgZnJvbSAnLi9HYW1lUGxheSc7XG5pbXBvcnQgR2FtZUNvbnRyb2xsZXIgZnJvbSAnLi9HYW1lQ29udHJvbGxlcic7XG5cbmNvbnN0IGdhbWVQbGF5ID0gbmV3IEdhbWVQbGF5KDQpO1xuZ2FtZVBsYXkuYmluZFRvRE9NKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnYW1lLWNvbnRhaW5lcicpKTtcblxuY29uc3QgZ2FtZUN0cmwgPSBuZXcgR2FtZUNvbnRyb2xsZXIoZ2FtZVBsYXkpO1xuZ2FtZUN0cmwuaW5pdCgpO1xuIiwiaW1wb3J0IGNhbGNUaWxlVHlwZSBmcm9tICcuL3V0aWxzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZVBsYXkge1xuICBjb25zdHJ1Y3Rvcihib2FyZFNpemUpIHtcbiAgICB0aGlzLmJvYXJkU2l6ZSA9IGJvYXJkU2l6ZTtcbiAgICB0aGlzLmNvbnRhaW5lciA9IG51bGw7XG4gICAgdGhpcy5ib2FyZEVsID0gbnVsbDtcbiAgICB0aGlzLmNlbGxzID0gW107XG4gICAgdGhpcy5jZWxsQ2xpY2tMaXN0ZW5lcnMgPSBbXTtcbiAgICB0aGlzLmNlbGxFbnRlckxpc3RlbmVycyA9IFtdO1xuICAgIHRoaXMuY2VsbExlYXZlTGlzdGVuZXJzID0gW107XG4gIH1cblxuICBiaW5kVG9ET00oY29udGFpbmVyKSB7XG4gICAgaWYgKCEoY29udGFpbmVyIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbnRhaW5lciBpcyBub3QgSFRNTEVsZW1lbnQnKTtcbiAgICB9XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gIH1cblxuICBkcmF3VWkodGhlbWUpIHtcbiAgICB0aGlzLmNoZWNrQmluZGluZygpO1xuXG4gICAgdGhpcy5jb250YWluZXIuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cImJvYXJkLWNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGRhdGEtaWQ9XCJib2FyZFwiIGNsYXNzPVwiYm9hcmRcIj48L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG5cbiAgICB0aGlzLmJvYXJkRWwgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1ib2FyZF0nKTtcblxuICAgIHRoaXMuYm9hcmRFbC5jbGFzc0xpc3QuYWRkKHRoZW1lKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm9hcmRTaXplICoqIDI7IGkgKz0gMSkge1xuICAgICAgY29uc3QgY2VsbEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBjZWxsRWwuY2xhc3NMaXN0LmFkZCgnY2VsbCcsICdtYXAtdGlsZScsIGBtYXAtdGlsZS0ke2NhbGNUaWxlVHlwZShpLCB0aGlzLmJvYXJkU2l6ZSl9YCk7XG4gICAgICBjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChldmVudCkgPT4gdGhpcy5vbkNlbGxFbnRlcihldmVudCkpO1xuICAgICAgY2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoZXZlbnQpID0+IHRoaXMub25DZWxsTGVhdmUoZXZlbnQpKTtcbiAgICAgIGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gdGhpcy5vbkNlbGxDbGljayhldmVudCkpO1xuICAgICAgdGhpcy5ib2FyZEVsLmFwcGVuZENoaWxkKGNlbGxFbCk7XG4gICAgfVxuXG4gICAgdGhpcy5jZWxscyA9IEFycmF5LmZyb20odGhpcy5ib2FyZEVsLmNoaWxkcmVuKTtcbiAgfVxuXG4gIHJlZHJhd1Bvc2l0aW9ucyhwb3NpdGlvbikge1xuICAgIGZvciAoY29uc3QgY2VsbCBvZiB0aGlzLmNlbGxzKSB7XG4gICAgICBjZWxsLmlubmVySFRNTCA9ICcnO1xuICAgIH1cblxuICAgIGNvbnN0IGNlbGxFbCA9IHRoaXMuYm9hcmRFbC5jaGlsZHJlbltwb3NpdGlvbl07XG4gICAgY29uc3QgY2hhckVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY2hhckVsLmNsYXNzTGlzdC5hZGQoJ2NoYXJhY3RlcicsICdnZW5lcmljJyk7XG5cbiAgICBjZWxsRWwuYXBwZW5kQ2hpbGQoY2hhckVsKTtcbiAgfVxuXG4gIGFkZENlbGxFbnRlckxpc3RlbmVyKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jZWxsRW50ZXJMaXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XG4gIH1cblxuICBhZGRDZWxsTGVhdmVMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuY2VsbExlYXZlTGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xuICB9XG5cbiAgYWRkQ2VsbENsaWNrTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNlbGxDbGlja0xpc3RlbmVycy5wdXNoKGNhbGxiYWNrKTtcbiAgfVxuXG4gIG9uQ2VsbEVudGVyKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLmNlbGxFbnRlckxpc3RlbmVycy5mb3JFYWNoKChvKSA9PiBvLmNhbGwobnVsbCwgaW5kZXgpKTtcbiAgfVxuXG4gIG9uQ2VsbExlYXZlKGV2ZW50KSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLmNlbGxMZWF2ZUxpc3RlbmVycy5mb3JFYWNoKChvKSA9PiBvLmNhbGwobnVsbCwgaW5kZXgpKTtcbiAgfVxuXG4gIG9uQ2VsbENsaWNrKGV2ZW50KSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmNlbGxzLmluZGV4T2YoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgdGhpcy5jZWxsQ2xpY2tMaXN0ZW5lcnMuZm9yRWFjaCgobykgPT4gby5jYWxsKG51bGwsIGluZGV4KSk7XG4gIH1cblxuICBzZWxlY3RDZWxsKGluZGV4LCBjb2xvciA9ICdyZWQnKSB7XG4gICAgdGhpcy5kZXNlbGVjdENlbGwoaW5kZXgpO1xuICAgIHRoaXMuY2VsbHNbaW5kZXhdLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJywgYHNlbGVjdGVkLSR7Y29sb3J9YCk7XG4gIH1cblxuICBkZXNlbGVjdENlbGwoaW5kZXgpIHtcbiAgICBjb25zdCBjZWxsID0gdGhpcy5jZWxsc1tpbmRleF07XG4gICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKC4uLkFycmF5LmZyb20oY2VsbC5jbGFzc0xpc3QpXG4gICAgICAuZmlsdGVyKChvKSA9PiBvLnN0YXJ0c1dpdGgoJ3NlbGVjdGVkJykpKTtcbiAgfVxuXG4gIGhpZGVDZWxsVG9vbHRpcChpbmRleCkge1xuICAgIHRoaXMuY2VsbHNbaW5kZXhdLnRpdGxlID0gJyc7XG4gIH1cblxuICBzZXRDdXJzb3IoY3Vyc29yKSB7XG4gICAgdGhpcy5ib2FyZEVsLnN0eWxlLmN1cnNvciA9IGN1cnNvcjtcbiAgfVxuXG4gIGNoZWNrQmluZGluZygpIHtcbiAgICBpZiAodGhpcy5jb250YWluZXIgPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignR2FtZVBsYXkgbm90IGJpbmQgdG8gRE9NJyk7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgY3JlYXRlUG9zaXRpb24gZnJvbSAnLi9jcmVhdGVQb3NpdGlvbic7XG5pbXBvcnQgY3Vyc29ycyBmcm9tICcuL2N1cnNvcnMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKGdhbWVQbGF5KSB7XG4gICAgdGhpcy5nYW1lUGxheSA9IGdhbWVQbGF5O1xuICAgIHRoaXMuaW5kZXhTZWxlY3QgPSB7fTtcbiAgICB0aGlzLm9uQ2VsbENsaWNrID0gdGhpcy5vbkNlbGxDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DZWxsRW50ZXIgPSB0aGlzLm9uQ2VsbEVudGVyLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNlbGxMZWF2ZSA9IHRoaXMub25DZWxsTGVhdmUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgdGhpcy5ldmVudHMoKTtcbiAgICB0aGlzLmdhbWVQbGF5LmRyYXdVaSgncHJhaXJpZScpO1xuICAgIHRoaXMuc2hvd0NoYXJhY3RlcigpO1xuICB9XG5cbiAgZXZlbnRzKCkge1xuICAgIHRoaXMuZ2FtZVBsYXkuYWRkQ2VsbEVudGVyTGlzdGVuZXIodGhpcy5vbkNlbGxFbnRlcik7XG4gICAgdGhpcy5nYW1lUGxheS5hZGRDZWxsTGVhdmVMaXN0ZW5lcih0aGlzLm9uQ2VsbExlYXZlKTtcbiAgICB0aGlzLmdhbWVQbGF5LmFkZENlbGxDbGlja0xpc3RlbmVyKHRoaXMub25DZWxsQ2xpY2spO1xuICB9XG5cbiAgb25DZWxsQ2xpY2soaW5kZXgpIHtcbiAgICB0aGlzLmdhbWVQbGF5LnNldEN1cnNvcihjdXJzb3JzLmNyb3NzaGFpcik7XG4gICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zZWxlY3RlZC1yZWQnKSkge1xuICAgICAgdGhpcy5nYW1lUGxheS5kZXNlbGVjdENlbGwodGhpcy5pbmRleFNlbGVjdC5yZWQpO1xuICAgIH1cblxuICAgIHRoaXMuZ2FtZVBsYXkuc2VsZWN0Q2VsbChpbmRleCk7XG4gICAgdGhpcy5pbmRleFNlbGVjdC5yZWQgPSBpbmRleDtcbiAgfVxuXG4gIG9uQ2VsbEVudGVyKCkge1xuICAgIHRoaXMuZ2FtZVBsYXkuc2V0Q3Vyc29yKGN1cnNvcnMucG9pbnRlcik7XG4gIH1cblxuICBvbkNlbGxMZWF2ZShpbmRleCkge1xuICAgIHRoaXMuZ2FtZVBsYXkuaGlkZUNlbGxUb29sdGlwKGluZGV4KTtcbiAgfVxuXG4gIHNob3dDaGFyYWN0ZXIoKSB7XG4gICAgY29uc3QgdGltZXJJZCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gY3JlYXRlUG9zaXRpb24odGhpcy5nYW1lUGxheS5ib2FyZFNpemUpO1xuICAgICAgdGhpcy5nYW1lUGxheS5yZWRyYXdQb3NpdGlvbnMocG9zaXRpb24pO1xuICAgIH0sIDEwMDApO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiBjbGVhckludGVydmFsKHRpbWVySWQpLCAxMDAwMDAwKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImNhbGNUaWxlVHlwZSIsImluZGV4IiwiYm9hcmRTaXplIiwiaXNUb3BSb3ciLCJpc0JvdHRvbVJvdyIsImlzTGVmdENvbHVtbiIsImlzUmlnaHRDb2x1bW4iLCJsYXN0UG9zaXRpb24iLCJjcmVhdGVQb3NpdGlvbiIsImNlbGxzIiwidG90YWxDZWxscyIsIkFycmF5IiwiZnJvbSIsImxlbmd0aCIsIl8iLCJpIiwiZmxhdE1hcCIsImNlbGwiLCJjcmVhdGVBcnJheVBvc2l0aW9ucyIsInJhbmQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJhdXRvIiwicG9pbnRlciIsImNyb3NzaGFpciIsIm5vdGFsbG93ZWQiLCJnYW1lUGxheSIsImNvbnN0cnVjdG9yIiwidGhpcyIsImNvbnRhaW5lciIsImJvYXJkRWwiLCJjZWxsQ2xpY2tMaXN0ZW5lcnMiLCJjZWxsRW50ZXJMaXN0ZW5lcnMiLCJjZWxsTGVhdmVMaXN0ZW5lcnMiLCJiaW5kVG9ET00iLCJIVE1MRWxlbWVudCIsIkVycm9yIiwiZHJhd1VpIiwidGhlbWUiLCJjaGVja0JpbmRpbmciLCJpbm5lckhUTUwiLCJxdWVyeVNlbGVjdG9yIiwiY2xhc3NMaXN0IiwiYWRkIiwiY2VsbEVsIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwib25DZWxsRW50ZXIiLCJvbkNlbGxMZWF2ZSIsIm9uQ2VsbENsaWNrIiwiYXBwZW5kQ2hpbGQiLCJjaGlsZHJlbiIsInJlZHJhd1Bvc2l0aW9ucyIsInBvc2l0aW9uIiwiY2hhckVsIiwiYWRkQ2VsbEVudGVyTGlzdGVuZXIiLCJjYWxsYmFjayIsInB1c2giLCJhZGRDZWxsTGVhdmVMaXN0ZW5lciIsImFkZENlbGxDbGlja0xpc3RlbmVyIiwicHJldmVudERlZmF1bHQiLCJpbmRleE9mIiwiY3VycmVudFRhcmdldCIsImZvckVhY2giLCJvIiwiY2FsbCIsInNlbGVjdENlbGwiLCJjb2xvciIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsImRlc2VsZWN0Q2VsbCIsInJlbW92ZSIsImZpbHRlciIsInN0YXJ0c1dpdGgiLCJoaWRlQ2VsbFRvb2x0aXAiLCJ0aXRsZSIsInNldEN1cnNvciIsImN1cnNvciIsInN0eWxlIiwiZ2FtZUN0cmwiLCJpbmRleFNlbGVjdCIsImJpbmQiLCJpbml0IiwiZXZlbnRzIiwic2hvd0NoYXJhY3RlciIsImN1cnNvcnMiLCJyZWQiLCJ0aW1lcklkIiwic2V0SW50ZXJ2YWwiLCJzZXRUaW1lb3V0IiwiY2xlYXJJbnRlcnZhbCJdLCJzb3VyY2VSb290IjoiIn0=